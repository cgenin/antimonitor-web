(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{2561:function(e,t,r){"use strict";var n=r("92f9"),o=r.n(n);o.a},"3cb9":function(e,t,r){"use strict";var n=r("717c"),o=r.n(n);o.a},"717c":function(e,t,r){},"92f9":function(e,t,r){},c5fb:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"projects-page page-list container"},[r("header-app",{attrs:{"bc-datas":[{icon:"view_list",label:"Liste des Projets NPM"}]}}),r("q-card",[r("q-card-section",[r("h3",[e._v("Comparaison de serveurs")])]),r("q-separator"),r("q-card-section",[e.servers?r("q-select",{staticClass:"selectServer",attrs:{"float-label":"Sélectionner un (ou plusieurs) serveurs",options:e.servers,multiple:""},on:{input:e.serverChanged},model:{value:e.serverList,callback:function(t){e.serverList=t},expression:"serverList"}}):e._e(),e.services?r("div",[r("q-inner-loading",{attrs:{visible:e.loading}},[r("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1),e.columns.length>1?r("q-table",{attrs:{data:e.services,columns:e.columns,"row-key":"field",filter:e.filter,separator:e.separator,"no-data-label":e.noData,pagination:e.pagination,"no-results-label":e.noDataAfterFiltering,rowsPerPageOptions:e.rowsPerPageOptions},on:{"update:pagination":function(t){e.pagination=t},refresh:e.refresh},scopedSlots:e._u([{key:"body-cell-compare",fn:function(t){return r("q-td",{attrs:{props:t}},[e.servicesByServer[t.col.label][t.value].info&&e.servicesByServer[t.col.label][t.value].info.build?r("div",[r("charts-button",{attrs:{serviceInfos:e.servicesByServer[t.col.label][t.value],serviceName:t.value,server:t.col.label}})],1):e._e(),e.servicesByServer[t.col.label][t.value].responding?e._e():r("span",[r("q-item-side",{staticClass:"down",attrs:{icon:"portable_wifi_off"}})],1),e.servicesByServer[t.col.label][t.value].info&&e.servicesByServer[t.col.label][t.value].info.build||!e.servicesByServer[t.col.label][t.value].responding?e._e():r("span",[r("q-item-side",{staticClass:"up",attrs:{icon:"graphic_eq"}}),e._v(" Up but no infos...\n              ")],1)])}}],null,!1,2160448503)},[r("template",{slot:"top-left"},[r("q-input",{staticClass:"col-auto",attrs:{debounce:300},scopedSlots:e._u([{key:"append",fn:function(){return[r("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,4009527860),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1),r("template",{slot:"top-right"},[r("q-select",{attrs:{color:"secondary",options:e.separatorOptions,"hide-underline":"","emit-value":""},model:{value:e.separator,callback:function(t){e.separator=t},expression:"separator"}})],1)],2):e._e()],1):e._e()],1)],1)],1)},o=[],i=r("2b0e"),s=r("2fe1"),a=r("4bb5"),c=r("4e54"),l=r("130c"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"row align-stretch"},[e.serviceName&&e.server?r("q-btn",{staticClass:"btn-version",attrs:{color:"secondary",size:"sm"},on:{click:e.openModal}},[e.serviceInfos.info&&e.serviceInfos.info.build?r("span",[r("strong",[e._v(e._s(e.serviceInfos.info.build.version))]),r("br"),r("span",[e._v(e._s(e.formatYYYYMMDDHHmm(e.serviceInfos.info.build.timestamp)))])]):e._e()]):e._e(),r("markdown-button",{attrs:{icon:"list",color:"orange-4",title:"Properties",content:e.properties},on:{click:e.openProperties}}),r("q-dialog",{ref:"layoutModal",on:{hide:e.closingModal},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[r("q-layout",{staticClass:"bg-white",style:{minWidth:"55vw",minHeight:"85vh",padding:"1em"},attrs:{view:"hHh Lpr fFf",container:""}},[r("q-header",{staticClass:"bg-primary"},[r("q-toolbar",[r("q-toolbar-title",[e._v('\n            "'+e._s(e.serviceName)+'" sur le serveur '+e._s(e.server)+"\n          ")]),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1)],1),r("q-page-container",[r("q-page",{attrs:{padding:""}},[r("div",{staticClass:"layout-padding"},[r("q-inner-loading",{attrs:{visible:e.loading}},[r("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1),e.service&&e.modal&&e.displayGraph?r("div",[r("h2",[e._v("Temps de réponse")]),r("div",[e._v("Moyenne : "+e._s(e.getAverage())+"ms")]),r("div",[e._v("80% : "+e._s(e.get80())+"ms")]),r("hr"),r("response-time-chart",{attrs:{service:e.service}}),r("h2",[e._v("Nombre de requête par url")]),r("counter-chart",{attrs:{service:e.service}}),r("h2",[e._v("Répartition des status HTTP")]),r("success-chart",{attrs:{service:e.service}})],1):e._e()],1)])],1)],1)],1)],1)},p=[],f=(r("4de4"),r("caad"),r("d81d"),r("13d5"),r("4e82"),r("a434"),r("b64b"),r("07ac"),r("ac1f"),r("2532"),r("5319"),r("2ca0"),r("1fca")),v=i["a"].component("response-time-chart",{extends:f["b"],props:["service"],mounted:function(){this.getStats()},methods:{getStats:function(){var e=this.service,t=Object.keys(e.metrics).filter((function(e){return e.startsWith("gauge")&&!e.includes("hystrix")})).sort((function(t,r){return e.metrics[t]-e.metrics[r]})),r=t.splice(0,this.limit||t.length).reduce((function(t,r){return t[r]=e.metrics[r],t}),{});this.renderChart({labels:Object.keys(r).map((function(e){return e.replace(/(gauge\.response\.)/g,"").replace(/\./g,"/")})),datasets:[{label:"ms",backgroundColor:"white",borderColor:"#ff5722",data:Object.values(r)}]},{animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,responsive:!0,maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{display:!1}]},layout:{padding:{left:0,right:10,top:0,bottom:0}}})}},watch:{service:function(){this.getStats()},limit:function(){this.getStats()}}}),d=(r("99af"),i["a"].component("counter-chart",{extends:f["b"],props:["service","limit"],mounted:function(){this.getStats()},methods:{formatDate:function(e){var t=new Date(e);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear()," ").concat(t.getHours(),":").concat(t.getMinutes())},getStats:function(){var e=this,t=Object.keys(this.service.metrics).sort((function(e,t){return e.localeCompare(t)})).filter((function(e){return e.startsWith("counter")&&!e.includes("hystrix")})),r=t.splice(0,this.limit||t.length).reduce((function(t,r){return t[r]=e.service.metrics[r],t}),{});this.renderChart({labels:Object.keys(r).map((function(e){return e.replace(/(counter\.status\.)([0-9]{3})(\.)/g,"Status $2 : /").replace(/\./g,"/")})),datasets:[{label:" requests",backgroundColor:"white",borderColor:"#ff5722",data:Object.values(r)}]},{animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,responsive:!0,maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{display:!1}]}})}},watch:{service:function(){this.getStats()},limit:function(){this.getStats()}}})),h=(r("a9e3"),i["a"].component("success-chart",{extends:f["a"],props:["service","limit"],mounted:function(){this.getStats()},methods:{getColor:function(e){switch(e){case"200":return"#2fee68";case"204":return"#36eece";case"400":return"#6590ee";case"401":return"#ee9f21";case"500":return"#ee3e38";default:return"#".concat(e)}},getStats:function(){var e=this,t=Object.keys(this.service.metrics).filter((function(e){return e.startsWith("counter")&&!e.includes("hystrix")})),r=t.map((function(t){return{key:t.replace(/(counter\.status\.)([0-9]{3})(.*)/g,"$2"),value:e.service.metrics[t]}})).reduce((function(e,t){return e[t.key]=Number(e[t.key]||0)+t.value,e}),{});this.renderChart({labels:Object.keys(r),datasets:[{data:Object.values(r),backgroundColor:Object.keys(r).map((function(t){return e.getColor(t)})),borderWidth:0}]},{responsive:!0,maintainAspectRatio:!1})}},watch:{service:function(){this.getStats()}}})),b=r("cc50"),m=r("c1a1"),g=r("60a3"),y=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),w=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},_=function(e,t,r,n){function o(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(t){i(t)}}function a(e){try{c(n["throw"](e))}catch(t){i(t)}}function c(e){e.done?r(e.value):o(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())}))},S=function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,n&&(o=2&i[0]?n["return"]:i[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},O=Object(a["a"])(c["e"]),j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.modal=!1,t.displayGraph=!1,t.loading=!1,t.properties=" ",t}return y(t,e),t.prototype.loadServiceData=function(){return _(this,void 0,void 0,(function(){var e,t=this;return S(this,(function(r){switch(r.label){case 0:return this.loading=!0,this.serviceName&&this.server?(e={service:this.serviceName,server:this.server},[4,this.getServiceForServer(e).then((function(e){t.service=e.servers.find((function(e){return e.host===t.server}))})).catch((function(e){console.error("Error while recuperating datas",e)})).then((function(){setTimeout((function(){t.loading=!1,t.displayGraph=!0}),0)}))]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.getAverage=function(){var e=this.getMetrics();return e.reduce((function(e,t){return e+t}),0)/e.length},t.prototype.get80=function(){var e=this.getMetrics();return e.sort((function(e,t){return e-t}))[Math.floor(.8*e.length)]},t.prototype.getMetrics=function(){var e=this,t=Object.keys(this.service.metrics).filter((function(e){return e.startsWith("gauge")&&!e.includes("hystrix")}));return t.reduce((function(t,r){return t.push(e.service.metrics[r]),t}),[])},t.prototype.openModal=function(){return _(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.modal=!0,[4,this.loadServiceData()];case 1:return e.sent(),[2]}}))}))},t.prototype.formatKeys=function(e){return Object.keys(e).sort((function(e,t){return e.localeCompare(t)})).reduce((function(t,r){return"\n"+t+"\n"+r+"="+e[r]+"\n"}),"")},t.prototype.openProperties=function(){return _(this,void 0,void 0,(function(){var e,t=this;return S(this,(function(r){switch(r.label){case 0:return this.properties="Chargement des données en cours...",[4,this.loadServiceData()];case 1:return r.sent(),e=Object.keys(this.service.env).filter((function(e){return"systemProperties"!==e&&"systemEnvironment"!==e&&"servletContextInitParams"!==e})).sort((function(e,t){return e.localeCompare(t)})).reduce((function(e,r){return"\n"+e+"\n----\n"+r+"\n----\n"+t.formatKeys(t.service.env[r])+"\n          "}),""),this.properties=e,[2]}}))}))},t.prototype.closingModal=function(){this.displayGraph=!1},t.prototype.formatYYYYMMDDHHmm=function(e){return Object(b["b"])(Object(b["c"])(e))},w([Object(g["c"])()],t.prototype,"serviceName",void 0),w([Object(g["c"])()],t.prototype,"server",void 0),w([Object(g["c"])()],t.prototype,"serviceInfos",void 0),w([O.Action(c["b"])],t.prototype,"getServiceForServer",void 0),t=w([Object(s["b"])({components:{MarkdownButton:m["a"],ResponseTimeChart:v,CounterChart:d,SuccessChart:h}})],t),t}(i["a"]),C=j,k=C,P=(r("2561"),r("2877")),x=r("9c40"),q=r("24e8"),Q=r("4d5a"),D=r("e359"),A=r("65c6"),M=r("6ac5"),N=r("09e3"),R=r("9989"),T=r("74f7"),B=r("cf57"),I=r("eaac"),H=r("7f67"),L=r("eebe"),G=r.n(L),Y=Object(P["a"])(k,u,p,!1,null,null,null),F=Y.exports;G()(Y,"components",{QBtn:x["a"],QDialog:q["a"],QLayout:Q["a"],QHeader:D["a"],QToolbar:A["a"],QToolbarTitle:M["a"],QPageContainer:N["a"],QPage:R["a"],QInnerLoading:T["a"],QSpinnerGears:B["a"],QTable:I["a"]}),G()(Y,"directives",{ClosePopup:H["a"]});var E=r("61c9"),W=r("d69e"),$=r("4c08"),z=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),J=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},K=function(e,t,r,n){function o(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(t){i(t)}}function a(e){try{c(n["throw"](e))}catch(t){i(t)}}function c(e){e.done?r(e.value):o(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())}))},U=function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,n&&(o=2&i[0]?n["return"]:i[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},V=Object(a["a"])(c["e"]),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.serverList=[],t.services=[],t.servicesByServer=[],t.selected=null,t.loading=!1,t.filter="",t.separator=$["e"],t.separatorOptions=$["f"],t.pagination=$["c"],t.noData=$["a"],t.noDataAfterFiltering=$["b"],t.rowsPerPageOptions=$["d"],t.servers=null,t.server=null,t.columns=[],t.runningPromise=null,t.cancelRunningPromise=!1,t.moniThorUrl=null,t}return z(t,e),t.prototype.refresh=function(){this.filter=""},t.prototype.objectAsArray=function(e){return Object.keys(e).map((function(t){return e[t]}))},t.prototype.serverChanged=function(e){var t=this;this.cancelRunningPromise=!!this.runningPromise,this.loading=!0,this.columns=[{label:"Services",field:"serviceName",name:"serviceName",type:"string",filter:!0,align:"left"}];var r=e.map((function(e){return t.pingServer({server:e}).then((function(r){return t.servicesByServer[e]=r.reduce((function(e,t){return e[t.serviceName]=t,e}),{}),t.services=r.map((function(e){return{serviceName:e.serviceName}})).sort((function(e,t){return e.serviceName.localeCompare(t.serviceName)})),t.original=t.services,e}))}));this.runningPromise=Promise.all(r).then((function(e){t.cancelRunningPromise?t.cancelRunningPromise=!1:e.forEach((function(e){t.serverList.includes(e)&&0===t.columns.filter((function(t){return t.label===e})).length&&t.columns.push({label:e,field:"serviceName",name:"compare",sortable:!0,type:"string",filter:!0,align:"left"})}))})).catch((function(e){console.error(e)})).then((function(){t.loading=!1,t.runningPromise=null}))},t.prototype.filtering=function(){this.services=Object(W["a"])(this.original,this.filter)},t.prototype.mounted=function(){return K(this,void 0,void 0,(function(){return U(this,(function(e){switch(e.label){case 0:return this.pagination.rowsPerPage=50,[4,this.loadServers()];case 1:return e.sent(),this.servers=this.serverFromStore.map((function(e){return{label:e,value:e}})),this.refresh(),[2]}}))}))},J([V.Getter(c["g"])],t.prototype,"serverFromStore",void 0),J([V.Action(c["d"])],t.prototype,"loadServers",void 0),J([V.Action(c["f"])],t.prototype,"pingServer",void 0),t=J([Object(s["b"])({components:{HeaderApp:E["a"],ChangelogButton:l["a"],ChartsButton:F}})],t),t}(i["a"]),Z=X,ee=Z,te=(r("3cb9"),r("f09f")),re=r("a370"),ne=r("eb85"),oe=r("ddd8"),ie=r("27f9"),se=r("0016"),ae=r("db86"),ce=r("66e5"),le=Object(P["a"])(ee,n,o,!1,null,null,null);t["default"]=le.exports;G()(le,"components",{QCard:te["a"],QCardSection:re["a"],QSeparator:ne["a"],QSelect:oe["a"],QInnerLoading:T["a"],QSpinnerGears:B["a"],QTable:I["a"],QInput:ie["a"],QIcon:se["a"],QTd:ae["a"],QItem:ce["a"]})}}]);